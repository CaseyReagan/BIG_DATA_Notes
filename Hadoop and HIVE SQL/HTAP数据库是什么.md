#  HTAP数据库是什么
本文借鉴：1. https://cloud.tencent.com.cn/developer/information/%E6%95%B0%E6%8D%AE%E5%BA%93htap-video

## 总结
是一种很新的，将传统数据库事务处理，和在线分析处理，结合在一起的一种数据库架构。   

### （一）背景
查看GP6的新属性的时候，看到讲了很多对HTAP模式的优化，了解一下什么是HTAP数据库。   
***

### （二）什么是OLTP和OLAP
在传统的数据库架构中，OLTP和OLAP通常是分开的，分别由不同的数据库系统处理。   

1. 在线事务处理OLTP（Online Transaction Processing）：主要用于处理实时的事务操作，如插入、更新和删除数据，以支持业务的日常运作。数据结构以行为单位存储，适合于快速读取和更新单个记录。系统通常包括索引和锁机制来提高查询速度和防止数据冲突。通常采用关系型数据库（如Mysql、Oracle等），是传统的关系型数据库的主要应用，主要是基本的、日常的事务处理。强调数据库内存效率，强调内存各种指标的命令率，强调并发操作。

2. 在线分析处理OLAP（Online Analytical Processing）：是数据仓库系统的主要应用，支持复杂的分析操作，侧重决策支持，并且提供直观易懂的查询结果。 做用户画像，核心是AP。主要用于数据分析和决策支持，处理大量历史数据并进行复杂查询和分析。数据结构以列为单位存储，便于执行聚合和计算操作。数据仓库是其核心组件，用于存储和管理历史数据。比如HIVE就属于OLAP（但HIVE不是一个数据库而是一个数据仓库管理系统）。

+ 尽管Hive不支持传统的OLTP操作，如复杂的事务和小数据量的快速查询，但是它可以与其他支持OLTP的系统（如Apache HBase）结合使用，以满足不同的需求。
***

### （三）那么HTAP数据库是什么呢
HTAP数据库说白了就是OLTP加上OLAP，Hybrid Transactional/Analytical Processing，基于分布式计算存储框架，能在同一份数据上保证事务的同时支持实时分析，省去了费时的ETL过程。它可以在实时事务处理的同时，支持复杂的分析查询。
   
例如：采用行列混存或行列转化技术来同时支持事务能力和分析功能。   
+ 行存为主，内存列存为辅。针对有需要的表会同时存在一份行存储和列存储，在列存储上做分析操作，在行存储上进行更新，定期同步到列存储里，可以灵活指定需要采用行存与列存的表，也可以系统运行时更改表特性。主要难点为哪些数据转为列存、如何用行存和列存回答查询，代表系统为Oracle；
+ 主机行存、备机内存列存，备机通过日志复制转为内存的列存提供分析能力。代表系统为MySQL HeatWave，分析型查询由系统查询引擎基于代价估计后决定是否下推到内存列引擎中执行，常被访问的热数据将会留在内存中，不常使用的冷数据将会被压缩后持久化到外存中；
+ 多副本行列共存，通过多副本进行存储，主采用行存，副本采用列存。代表性系统为TiDB，行存数据存储在TiKV中，列存数据存储在TiFlash中，行存和列存松耦合，通过异步复制Raft log的方式将更新从行存节点同步到列存节点，列存节点不参与Raft协议的日志提交和leader选举等分布式事务，具有较高负载隔离性和扩展性，数据分析新鲜度偏低；
+ 列存为主，行存为辅。增量数据通过delta表定期转为列存，主列存主要处理OLAP类分析查询，增量行存负责OLTP类事务操作，并直接将更新数据定期合并到主列存中。此类系统因为以列存为主，所以OLAP的性能很高，且增量行存直接与列存连接，数据分析的新鲜度也很高。但缺点也很明显，就是OLTP处理性能中等，扩展性也不高，负载隔离性很低，代表系统为SAP HANA，主列存通过压缩、向量执行和OLAP多维分析等技术进行查询加速，同时利用CPU多级缓存机制优化事务处理。   
   
数据库HTAP的优势包括：
   
1实时性：数据库HTAP能够在实时事务处理的同时，提供实时的分析查询结果，使企业能够更快地做出决策。
2简化架构：通过将OLTP和OLAP整合到同一个数据库系统中，减少了系统的复杂性和维护成本。
3数据一致性：数据库HTAP能够保证实时事务处理和分析查询之间的数据一致性，避免了数据不一致的问题。
4资源利用率：数据库HTAP能够充分利用硬件资源，提高系统的性能和吞吐量。
   
数据库HTAP的应用场景包括：
   
1金融行业：可以用于实时交易处理和风险管理分析。
2零售行业：可以用于实时库存管理和销售分析。
3物流行业：可以用于实时订单处理和配送路线优化。
4电信行业：可以用于实时话单处理和用户行为分析。

